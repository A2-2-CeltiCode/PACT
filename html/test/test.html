<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire d'adresse</title>
    <style>
        ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            border: 1px solid #ccc;
            max-height: 150px;
            overflow-y: auto;
        }
        li {
            padding: 8px;
            cursor: pointer;
        }
        li:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <form>
        <label for="ville">Ville:</label>
        <input type="text" id="ville" name="ville" autocomplete="off">
        <ul id="ville-suggestions"></ul>

        <label for="code-postal">Code Postal:</label>
        <input type="text" id="code-postal" name="code-postal" readonly>

        <label for="adresse">Adresse:</label>
        <input type="text" id="adresse" name="adresse" autocomplete="off">
        <ul id="adresse-suggestions"></ul>
    </form>

    <script>
        document.getElementById('ville').addEventListener('input', function() {
            const query = this.value;
            if (query.length > 2) {
                fetch(`https://nominatim.openstreetmap.org/search?city=${query}&countrycodes=FR&format=json&addressdetails=1&limit=10`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            const suggestions = data.map(item => item.address.city || item.address.town || item.address.village);
                            const suggestionsList = document.getElementById('ville-suggestions');
                            suggestionsList.innerHTML = '';
                            suggestions.forEach(suggestion => {
                                const li = document.createElement('li');
                                li.textContent = suggestion;
                                suggestionsList.appendChild(li);
                            });
                        } else {
                            console.error('Aucune suggestion trouvée.');
                        }
                    })
                    .catch(error => console.error('Erreur lors de la récupération des suggestions:', error));
            }
        });

        document.getElementById('ville-suggestions').addEventListener('click', function(event) {
            if (event.target.tagName === 'LI') {
                const selectedCity = event.target.textContent;
                document.getElementById('ville').value = selectedCity;
                document.getElementById('ville-suggestions').innerHTML = '';

                fetch(`https://nominatim.openstreetmap.org/search?city=${selectedCity}&countrycodes=FR&format=json&addressdetails=1&limit=1`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            const postalCode = data[0].address.postcode || 'Code postal non disponible';
                            document.getElementById('code-postal').value = postalCode;
                        }
                    })
                    .catch(error => console.error('Erreur lors de la récupération du code postal:', error));
            }
        });

        document.getElementById('adresse').addEventListener('input', function() {
            const query = this.value;
            const city = document.getElementById('ville').value;
            if (query.length > 2 && city) {
                fetch(`https://nominatim.openstreetmap.org/search?street=${query}&city=${city}&countrycodes=FR&format=json&addressdetails=1&limit=10`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            const suggestions = data.map(item => item.display_name);
                            const suggestionsList = document.getElementById('adresse-suggestions');
                            suggestionsList.innerHTML = '';
                            suggestions.forEach(suggestion => {
                                const li = document.createElement('li');
                                li.textContent = suggestion;
                                suggestionsList.appendChild(li);
                            });
                        }
                    });
            }
        });

        document.getElementById('adresse-suggestions').addEventListener('click', function(event) {
            if (event.target.tagName === 'LI') {
                const selectedAddress = event.target.textContent;
                document.getElementById('adresse').value = selectedAddress;
                document.getElementById('adresse-suggestions').innerHTML = '';
            }
        });
    </script>
</body>
</html>
